<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Data Preparation | Data Handling</title>
  <meta name="description" content="A guide to practical data handling with a focus on R and empirical economic research." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Data Preparation | Data Handling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/new_abacus.jpg" />
  <meta property="og:description" content="A guide to practical data handling with a focus on R and empirical economic research." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Data Preparation | Data Handling" />
  
  <meta name="twitter:description" content="A guide to practical data handling with a focus on R and empirical economic research." />
  <meta name="twitter:image" content="img/new_abacus.jpg" />

<meta name="author" content="Ulrich Matter" />


<meta name="date" content="2022-01-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources-data-gathering-data-import.html"/>
<link rel="next" href="data-analysis-first-steps.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Handling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#processing-data-simple-calculations-in-numeral-systems"><i class="fa fa-check"></i><b>2.1</b> Processing data: simple calculations in numeral systems</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data.html"><a href="data.html#the-binary-system"><i class="fa fa-check"></i><b>2.1.1</b> The binary system</a></li>
<li class="chapter" data-level="2.1.2" data-path="data.html"><a href="data.html#the-hexadecimal-system"><i class="fa fa-check"></i><b>2.1.2</b> The hexadecimal system</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#character-encoding"><i class="fa fa-check"></i><b>2.2</b> Character encoding</a></li>
<li class="chapter" data-level="2.3" data-path="data.html"><a href="data.html#computer-code-and-text-files"><i class="fa fa-check"></i><b>2.3</b> Computer code and text files</a></li>
<li class="chapter" data-level="2.4" data-path="data.html"><a href="data.html#data-processing-basics"><i class="fa fa-check"></i><b>2.4</b> Data processing basics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data.html"><a href="data.html#components-of-a-standard-computing-environment"><i class="fa fa-check"></i><b>2.4.1</b> Components of a standard computing environment</a></li>
<li class="chapter" data-level="2.4.2" data-path="data.html"><a href="data.html#illustration"><i class="fa fa-check"></i><b>2.4.2</b> Illustration</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html"><i class="fa fa-check"></i><b>3</b> Data Storage and Data Structures</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html#unstructured-data-in-text-files"><i class="fa fa-check"></i><b>3.1</b> Unstructured data in text files</a></li>
<li class="chapter" data-level="3.2" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html#structured-data-formats"><i class="fa fa-check"></i><b>3.2</b> Structured data formats</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html#csvs-and-fixed-width-format"><i class="fa fa-check"></i><b>3.2.1</b> CSVs and fixed-width format</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html#units-of-informationdata-storage"><i class="fa fa-check"></i><b>3.3</b> Units of information/data storage</a></li>
<li class="chapter" data-level="3.4" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html#data-structures-and-data-types-in-r"><i class="fa fa-check"></i><b>3.4</b> Data structures and data types in R</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html#data-types"><i class="fa fa-check"></i><b>3.4.1</b> Data types</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-storage-and-data-structures.html"><a href="data-storage-and-data-structures.html#data-structures"><i class="fa fa-check"></i><b>3.4.2</b> Data structures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="high-dimensional-data.html"><a href="high-dimensional-data.html"><i class="fa fa-check"></i><b>4</b> High-Dimensional Data</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="high-dimensional-data.html"><a href="high-dimensional-data.html#deciphering-xml"><i class="fa fa-check"></i><b>4.0.1</b> Deciphering XML</a></li>
<li class="chapter" data-level="4.1" data-path="high-dimensional-data.html"><a href="high-dimensional-data.html#deciphering-json"><i class="fa fa-check"></i><b>4.1</b> Deciphering JSON</a></li>
<li class="chapter" data-level="4.2" data-path="high-dimensional-data.html"><a href="high-dimensional-data.html#parsing-xml-and-json-in-r"><i class="fa fa-check"></i><b>4.2</b> Parsing XML and JSON in R</a></li>
<li class="chapter" data-level="4.3" data-path="high-dimensional-data.html"><a href="high-dimensional-data.html#html-computer-code-meets-data"><i class="fa fa-check"></i><b>4.3</b> HTML: Computer code meets data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="high-dimensional-data.html"><a href="high-dimensional-data.html#write-a-simple-webpage-with-html"><i class="fa fa-check"></i><b>4.3.1</b> Write a simple webpage with HTML</a></li>
<li class="chapter" data-level="4.3.2" data-path="high-dimensional-data.html"><a href="high-dimensional-data.html#two-ways-to-read-a-webpage-into-r"><i class="fa fa-check"></i><b>4.3.2</b> Two ways to read a webpage into R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="programming-with-data.html"><a href="programming-with-data.html"><i class="fa fa-check"></i><b>5</b> Programming with Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="programming-with-data.html"><a href="programming-with-data.html#first-steps-with-r"><i class="fa fa-check"></i><b>5.1</b> First steps with R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="programming-with-data.html"><a href="programming-with-data.html#variables-and-vectors"><i class="fa fa-check"></i><b>5.1.1</b> Variables and vectors</a></li>
<li class="chapter" data-level="5.1.2" data-path="programming-with-data.html"><a href="programming-with-data.html#math-operators"><i class="fa fa-check"></i><b>5.1.2</b> Math operators</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="programming-with-data.html"><a href="programming-with-data.html#basic-programming-concepts-in-r"><i class="fa fa-check"></i><b>5.2</b> Basic programming concepts in R</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="programming-with-data.html"><a href="programming-with-data.html#loops"><i class="fa fa-check"></i><b>5.2.1</b> Loops</a></li>
<li class="chapter" data-level="5.2.2" data-path="programming-with-data.html"><a href="programming-with-data.html#for-loops"><i class="fa fa-check"></i><b>5.2.2</b> For-loops</a></li>
<li class="chapter" data-level="5.2.3" data-path="programming-with-data.html"><a href="programming-with-data.html#booleans-and-logical-statements"><i class="fa fa-check"></i><b>5.2.3</b> Booleans and logical statements</a></li>
<li class="chapter" data-level="5.2.4" data-path="programming-with-data.html"><a href="programming-with-data.html#r-functions"><i class="fa fa-check"></i><b>5.2.4</b> R functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html"><i class="fa fa-check"></i><b>6</b> Data Sources, Data Gathering, Data Import</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#sourcesformats"><i class="fa fa-check"></i><b>6.1</b> Sources/formats</a></li>
<li class="chapter" data-level="6.2" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#data-gathering-procedure"><i class="fa fa-check"></i><b>6.2</b> Data gathering procedure</a></li>
<li class="chapter" data-level="6.3" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#loadingimporting-rectangular-data"><i class="fa fa-check"></i><b>6.3</b> Loading/importing rectangular data</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#loading-built-in-datasets"><i class="fa fa-check"></i><b>6.3.1</b> Loading built-in datasets</a></li>
<li class="chapter" data-level="6.3.2" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#importing-rectangular-data-from-text-files"><i class="fa fa-check"></i><b>6.3.2</b> Importing rectangular data from text-files</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#import-and-parsing-with-readr"><i class="fa fa-check"></i><b>6.4</b> Import and parsing with <code>readr</code></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#basic-usage-of-readr-functions"><i class="fa fa-check"></i><b>6.4.1</b> Basic usage of <code>readr</code> functions</a></li>
<li class="chapter" data-level="6.4.2" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#parsing-and-data-types"><i class="fa fa-check"></i><b>6.4.2</b> Parsing and data types</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#importing-web-data-formats"><i class="fa fa-check"></i><b>6.5</b> Importing web data formats</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#xml-in-r"><i class="fa fa-check"></i><b>6.5.1</b> XML in R</a></li>
<li class="chapter" data-level="6.5.2" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#json-in-r"><i class="fa fa-check"></i><b>6.5.2</b> JSON in R</a></li>
<li class="chapter" data-level="6.5.3" data-path="data-sources-data-gathering-data-import.html"><a href="data-sources-data-gathering-data-import.html#tutorial-advanced-importing-data-from-a-html-table-on-a-website"><i class="fa fa-check"></i><b>6.5.3</b> Tutorial (advanced): Importing data from a HTML table (on a website)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>7</b> Data Preparation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-preparation.html"><a href="data-preparation.html#cleaning-data-with-basic-string-operations"><i class="fa fa-check"></i><b>7.1</b> Cleaning data with basic string operations</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="data-preparation.html"><a href="data-preparation.html#findreplace-character-strings-recode-factor-levels"><i class="fa fa-check"></i><b>7.1.1</b> Find/replace character strings, recode factor levels</a></li>
<li class="chapter" data-level="7.1.2" data-path="data-preparation.html"><a href="data-preparation.html#removing-individual-characters-from-a-string"><i class="fa fa-check"></i><b>7.1.2</b> Removing individual characters from a string</a></li>
<li class="chapter" data-level="7.1.3" data-path="data-preparation.html"><a href="data-preparation.html#splitting-strings"><i class="fa fa-check"></i><b>7.1.3</b> Splitting strings</a></li>
<li class="chapter" data-level="7.1.4" data-path="data-preparation.html"><a href="data-preparation.html#parsing-dates"><i class="fa fa-check"></i><b>7.1.4</b> Parsing dates</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data-preparation.html"><a href="data-preparation.html#reshaping-datasets"><i class="fa fa-check"></i><b>7.2</b> Reshaping datasets</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="data-preparation.html"><a href="data-preparation.html#tidying-messy-datasets."><i class="fa fa-check"></i><b>7.2.1</b> Tidying messy datasets.</a></li>
<li class="chapter" data-level="7.2.2" data-path="data-preparation.html"><a href="data-preparation.html#pivoting-from-wide-to-long-gathering"><i class="fa fa-check"></i><b>7.2.2</b> Pivoting from ‘wide to long’ (“gathering”)</a></li>
<li class="chapter" data-level="7.2.3" data-path="data-preparation.html"><a href="data-preparation.html#pivoting-from-long-to-wide-spreading"><i class="fa fa-check"></i><b>7.2.3</b> Pivoting from ‘long to wide’ (“spreading”)</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data-preparation.html"><a href="data-preparation.html#tutorial-hotel-bookings-time-series"><i class="fa fa-check"></i><b>7.3</b> Tutorial: Hotel Bookings Time Series</a></li>
<li class="chapter" data-level="7.4" data-path="data-preparation.html"><a href="data-preparation.html#set-up-and-import"><i class="fa fa-check"></i><b>7.4</b> Set up and import</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html"><i class="fa fa-check"></i><b>8</b> Data Analysis: First Steps</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html#merging-datasets"><i class="fa fa-check"></i><b>8.1</b> Merging datasets</a></li>
<li class="chapter" data-level="8.2" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html#selecting-subsets"><i class="fa fa-check"></i><b>8.2</b> Selecting subsets</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html#filtering-datasets"><i class="fa fa-check"></i><b>8.2.1</b> Filtering datasets</a></li>
<li class="chapter" data-level="8.2.2" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html#mutating-datasets"><i class="fa fa-check"></i><b>8.2.2</b> Mutating datasets</a></li>
<li class="chapter" data-level="8.2.3" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html#aggregation-and-summary-statistics"><i class="fa fa-check"></i><b>8.2.3</b> Aggregation and summary statistics</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html#tutorial-analise-messy-excel-sheets"><i class="fa fa-check"></i><b>8.3</b> Tutorial: Analise messy Excel sheets</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-analysis-first-steps.html"><a href="data-analysis-first-steps.html#preparatory-steps"><i class="fa fa-check"></i><b>8.3.1</b> Preparatory steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html"><i class="fa fa-check"></i><b>9</b> Basic Econometrics in R</a>
<ul>
<li class="chapter" data-level="9.1" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html#statistical-modelling"><i class="fa fa-check"></i><b>9.1</b> Statistical modelling</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html#illustration-with-pseudo-data"><i class="fa fa-check"></i><b>9.1.1</b> Illustration with pseudo-data</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html#estimation-and-application"><i class="fa fa-check"></i><b>9.2</b> Estimation and Application</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html#model-specification"><i class="fa fa-check"></i><b>9.2.1</b> Model specification</a></li>
<li class="chapter" data-level="9.2.2" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html#raw-data"><i class="fa fa-check"></i><b>9.2.2</b> Raw data</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html#derivation-and-implementation-of-ols-estimator"><i class="fa fa-check"></i><b>9.3</b> Derivation and implementation of OLS estimator</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="basic-econometrics-in-r.html"><a href="basic-econometrics-in-r.html#regression-toolbox-in-r"><i class="fa fa-check"></i><b>9.3.1</b> Regression toolbox in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>10</b> Data Visualization</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-visualization.html"><a href="data-visualization.html#data-display"><i class="fa fa-check"></i><b>10.1</b> Data display</a></li>
<li class="chapter" data-level="10.2" data-path="data-visualization.html"><a href="data-visualization.html#data-visualisation-with-ggplot2"><i class="fa fa-check"></i><b>10.2</b> Data visualisation with <code>ggplot2</code></a></li>
<li class="chapter" data-level="10.3" data-path="data-visualization.html"><a href="data-visualization.html#grammar-of-graphics"><i class="fa fa-check"></i><b>10.3</b> ‘Grammar of Graphics’</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="data-visualization.html"><a href="data-visualization.html#ggplot2-basics"><i class="fa fa-check"></i><b>10.3.1</b> <code>ggplot2</code> basics</a></li>
<li class="chapter" data-level="10.3.2" data-path="data-visualization.html"><a href="data-visualization.html#tutorial"><i class="fa fa-check"></i><b>10.3.2</b> Tutorial</a></li>
<li class="chapter" data-level="10.3.3" data-path="data-visualization.html"><a href="data-visualization.html#loadingpreparing-the-data"><i class="fa fa-check"></i><b>10.3.3</b> Loading/preparing the data</a></li>
<li class="chapter" data-level="10.3.4" data-path="data-visualization.html"><a href="data-visualization.html#geometries-type-of-plot"><i class="fa fa-check"></i><b>10.3.4</b> Geometries (~ type of plot)</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="data-visualization.html"><a href="data-visualization.html#dynamic-documents"><i class="fa fa-check"></i><b>10.4</b> Dynamic documents</a></li>
<li class="chapter" data-level="10.5" data-path="data-visualization.html"><a href="data-visualization.html#tutorial-how-to-give-the-wrong-impression-with-data-visualisation"><i class="fa fa-check"></i><b>10.5</b> Tutorial: How to give the wrong impression with data visualisation</a></li>
<li class="chapter" data-level="10.6" data-path="data-visualization.html"><a href="data-visualization.html#background-and-aim"><i class="fa fa-check"></i><b>10.6</b> Background and aim</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="data-visualization.html"><a href="data-visualization.html#data-import-and-preparation"><i class="fa fa-check"></i><b>10.6.1</b> Data import and preparation</a></li>
<li class="chapter" data-level="10.6.2" data-path="data-visualization.html"><a href="data-visualization.html#plot"><i class="fa fa-check"></i><b>10.6.2</b> Plot</a></li>
<li class="chapter" data-level="10.6.3" data-path="data-visualization.html"><a href="data-visualization.html#cosmetics-theme"><i class="fa fa-check"></i><b>10.6.3</b> Cosmetics: theme</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#understanding-statistics-and-probability-with-code"><i class="fa fa-check"></i><b>A.1</b> Understanding statistics and probability with code</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="appendix-a.html"><a href="appendix-a.html#random-draws-and-distributions"><i class="fa fa-check"></i><b>A.1.1</b> Random draws and distributions</a></li>
<li class="chapter" data-level="A.1.2" data-path="appendix-a.html"><a href="appendix-a.html#illustration-of-variability"><i class="fa fa-check"></i><b>A.1.2</b> Illustration of variability</a></li>
<li class="chapter" data-level="A.1.3" data-path="appendix-a.html"><a href="appendix-a.html#skewness-and-kurtosis"><i class="fa fa-check"></i><b>A.1.3</b> Skewness and Kurtosis</a></li>
<li class="chapter" data-level="A.1.4" data-path="appendix-a.html"><a href="appendix-a.html#the-law-of-large-numbers"><i class="fa fa-check"></i><b>A.1.4</b> The Law of Large Numbers</a></li>
<li class="chapter" data-level="A.1.5" data-path="appendix-a.html"><a href="appendix-a.html#the-central-limit-theorem"><i class="fa fa-check"></i><b>A.1.5</b> The Central Limit Theorem</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Handling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-preparation" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Data Preparation</h1>
<p>Importing a dataset properly is just the first of several milestones until an analysis-ready dataset is generated. In some cases, cleaning the raw data is a necessary step to facilitate/enable proper parsing of the data set in order to import it. However, most of the cleaning/preparing (‘wrangling’) with the data follows after the proper parsing of structured data. Many aspects of data wrangling are specific to certain datasets and an entire curriculum could be filled with different approaches and tools to address specific problems. Moreover, proficiency in data wrangling is generally a matter of experience in working with data, gained over many years. Here, we focus on two quite general and broadly applicable techniques that are central to cleaning and preparing a dataset for analysis: Simple string operations (find/replace parts of text strings) and reshaping rectangular data (wide to long/long to wide). The former is focused on individual variables at a time, while the latter typically happens at the level of the entire dataset.</p>
<div id="cleaning-data-with-basic-string-operations" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Cleaning data with basic string operations</h2>
<p>Recall that most of the data we read into R for analytic purposes is essentially a collection of raw text (structured with special characters). When parsing the data in order to read it into R with high-level functions such as the ones provided in the <code>readr</code>-package, both the structure and the types of the data are considered. The resulting <code>data.frame</code>/<code>tibble</code> might thus contain variables (different columns) of type <code>character</code>, <code>factor</code>, or <code>integer</code>, etc. At this stage it often happens that the raw data is not clean enough for the parser to recognize the data types in each column correctly, and it resorts to just parsing it as <code>character</code>. Indeed, if we have to deal with a very messy dataset it can make a lot of sense to constrain the parser such that it reads each column as <code>character</code>.</p>
<p>As we will rely on functions provided in the <code>tidyverse</code>, we first load this package.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="data-preparation.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Let’s create a sample dataset to illustrate some of the typical issues regarding unclean data that we might encounter in empirical economic research (and many similar domains of data analysis).<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a></p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="data-preparation.html#cb206-1" aria-hidden="true" tabindex="-1"></a>messy_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">last_name =</span> <span class="fu">c</span>(<span class="st">&quot;Wayne&quot;</span>, <span class="st">&quot;Trump&quot;</span>, <span class="st">&quot;Karl Marx&quot;</span>),</span>
<span id="cb206-2"><a href="data-preparation.html#cb206-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">first_name =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Melania&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb206-3"><a href="data-preparation.html#cb206-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;Man&quot;</span>),</span>
<span id="cb206-4"><a href="data-preparation.html#cb206-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">date =</span> <span class="fu">c</span>(<span class="st">&quot;2018-11-15&quot;</span>, <span class="st">&quot;2018.11.01&quot;</span>, <span class="st">&quot;2018/11/02&quot;</span>),</span>
<span id="cb206-5"><a href="data-preparation.html#cb206-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">income =</span> <span class="fu">c</span>(<span class="st">&quot;150,000&quot;</span>, <span class="st">&quot;250000&quot;</span>, <span class="st">&quot;10000&quot;</span>),</span>
<span id="cb206-6"><a href="data-preparation.html#cb206-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Assuming we have managed to read this dataset from a local file (with all columns as type <code>character</code>), the next step is to clean each of the columns such that the dataset is ready for analysis. Thereby we want to make sure that each variable (column) is set to a meaningful data type, once it is cleaned. The <em>cleaning</em> of the parsed data is often easier to do when the data is of type <code>character</code>. Once it is cleaned, however, we can set it to a type that is more useful for the analysis part. For example, in the final dataset a column containing numeric values should be stored as <code>numeric</code> or <code>integer</code>, so we can perform math operations on it later on (compute sums, means, etc.).</p>
<div id="findreplace-character-strings-recode-factor-levels" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Find/replace character strings, recode factor levels</h3>
<p>Our dataset contains a typical categorical variable: <code>gender</code>. In R it is good practice to store such variables as type <code>factor</code>. Without really looking at the data values, we might thus be inclined to do the following:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="data-preparation.html#cb207-1" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(messy_df<span class="sc">$</span>gender)</span>
<span id="cb207-2"><a href="data-preparation.html#cb207-2" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>gender</span></code></pre></div>
<pre><code>## [1] male   female Man   
## Levels: female male Man</code></pre>
<p>The column is now of type <code>factor</code>. And we see that R defined the factor variable such that an observation can be one of three categories (‘levels’): <code>female</code>, <code>male</code>, or <code>Man</code>. In terms of content, that probably does not make too much sense. If we were to analyze the data later on and compute the share of males in the sample, we would only count one instead of two. Hence, we better <em>recode</em> the gender variable of male subjects as <code>male</code> and not <code>Man</code>. How can this be done programmatically?</p>
<p>One approach is to select all entries in <code>messy_df$gender</code> that are equal to <code>"Man"</code> and replace these entries with <code>"male"</code>.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="data-preparation.html#cb209-1" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>gender[messy_df<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">&quot;Man&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;male&quot;</span></span>
<span id="cb209-2"><a href="data-preparation.html#cb209-2" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>gender</span></code></pre></div>
<pre><code>## [1] male   female male  
## Levels: female male Man</code></pre>
<p>Note, however, that this approach is not really perfect, because R still considers <code>Man</code> as a valid possible category in this column. This can have consequences for certain types of analyses we might want to run on this dataset later on.<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> Alternatively, we can use a function <code>fct_recode()</code> (provided in <code>tidyverse</code>), specifically made for such operations with factors.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="data-preparation.html#cb211-1" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(messy_df<span class="sc">$</span>gender, <span class="st">&quot;male&quot;</span> <span class="ot">=</span> <span class="st">&quot;Man&quot;</span>)</span>
<span id="cb211-2"><a href="data-preparation.html#cb211-2" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>gender</span></code></pre></div>
<pre><code>## [1] male   female male  
## Levels: female male</code></pre>
<p>The latter can be very useful when several factor levels need to be recoded at once. Note that in both cases, the underlying logic is that we search for strings that are identical to <code>"Man"</code> and replace those values with <code>"male"</code>. Now, the gender variable is ready for analysis.</p>
</div>
<div id="removing-individual-characters-from-a-string" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Removing individual characters from a string</h3>
<p>The <code>income</code> column contains numbers, so let’s try to set this column to type <code>integer</code>.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="data-preparation.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(messy_df<span class="sc">$</span>income)</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1]     NA 250000  10000</code></pre>
<p>R is warning us that something did not go well when executing this code. We see that the first value of the original column has been replaced with <code>NA</code> (‘Not Available’/‘Not Applicable’/‘No Answer’). The reason is that the original value contained a comma (<code>,</code>) which is a special character. The function <code>as.integer()</code> does not know how to translate such a symbol to a number. Hence, the original data value cannot be translated into a number (integer). In order to resolve this issue, we have to remove the comma (<code>,</code>) from this string. Or, more precisely, we will locate this specific character <em>within</em> the string and replace it with an empty string (<code>""</code>) In order to do so, we’ll use the function <code>str_replace()</code> (for ‘string replace’).</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="data-preparation.html#cb216-1" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>income <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(messy_df<span class="sc">$</span>income, <span class="at">pattern =</span> <span class="st">&quot;,&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Now we can successfully set the column as type integer.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="data-preparation.html#cb217-1" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>income <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(messy_df<span class="sc">$</span>income)</span></code></pre></div>
</div>
<div id="splitting-strings" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Splitting strings</h3>
<p>From looking at the <code>last_name</code> and <code>first_name</code> columns of our messy dataset, it becomes clear that the last row is not accurately coded. <code>Karl</code> should show up in the <code>first_name</code> column. In order to correct this, we have to extract a part of one string and store this sub-string in another variable. There are several ways to do this. Here, it probably makes sense to split the original string into two parts, as the white space between <code>Karl</code> and <code>Marx</code> indicates the separation of first and last name. For this, we can use the function <code>str_split()</code>.</p>
<p>First, we split the strings at every occurrence of white space (<code>" "</code>). Setting the option <code>simplify=TRUE</code>, we get a matrix containing the individual sub-strings after the splitting.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="data-preparation.html#cb218-1" aria-hidden="true" tabindex="-1"></a>splitnames <span class="ot">&lt;-</span> <span class="fu">str_split</span>(messy_df<span class="sc">$</span>last_name, <span class="at">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb218-2"><a href="data-preparation.html#cb218-2" aria-hidden="true" tabindex="-1"></a>splitnames</span></code></pre></div>
<pre><code>##      [,1]    [,2]  
## [1,] &quot;Wayne&quot; &quot;&quot;    
## [2,] &quot;Trump&quot; &quot;&quot;    
## [3,] &quot;Karl&quot;  &quot;Marx&quot;</code></pre>
<p>As the first two observations did not contain any white space, there was nothing to split there and the function simply returned empty strings <code>""</code>. In a second step, we replace empty observations in the <code>first_name</code> column with the corresponding values in <code>splitnames</code>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="data-preparation.html#cb220-1" aria-hidden="true" tabindex="-1"></a>problem_cases <span class="ot">&lt;-</span> messy_df<span class="sc">$</span>first_name <span class="sc">==</span> <span class="st">&quot;&quot;</span></span>
<span id="cb220-2"><a href="data-preparation.html#cb220-2" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>first_name[problem_cases] <span class="ot">&lt;-</span> splitnames[problem_cases, <span class="dv">1</span>]</span></code></pre></div>
<p>Finally, we have to correct the <code>last_name</code> column by replacing the respective values.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="data-preparation.html#cb221-1" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>last_name[problem_cases] <span class="ot">&lt;-</span> splitnames[problem_cases, <span class="dv">2</span>]</span>
<span id="cb221-2"><a href="data-preparation.html#cb221-2" aria-hidden="true" tabindex="-1"></a>messy_df</span></code></pre></div>
<pre><code>##   last_name first_name gender       date income
## 1     Wayne       John   male 2018-11-15 150000
## 2     Trump    Melania female 2018.11.01 250000
## 3      Marx       Karl   male 2018/11/02  10000</code></pre>
</div>
<div id="parsing-dates" class="section level3" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> Parsing dates</h3>
<p>Finally, we take a look at the <code>date</code>-column of our dataset. For many data preparation steps as well as visualization and analysis, it is advantageous to have times and dates properly parsed as type <code>Date</code>. In practice, dates and times are often particularly messy because no unique standard has been used to define the format in the data collection phase. This seems also to be the case in our dataset. In order to work with dates, we load the <code>lubridate</code> package.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="data-preparation.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p>This package provides several functions to parse and manipulate date and time data. From looking at the <code>date</code>-column we see that the format is basically year, month, day. We can thus use the <code>ymd()</code>-function provided in the <code>lubridate</code>-package in order to parse the column as <code>Date</code> type.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="data-preparation.html#cb224-1" aria-hidden="true" tabindex="-1"></a>messy_df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(messy_df<span class="sc">$</span>date)</span></code></pre></div>
<p>Note how this function automatically recognizes how different special characters have been used in different observations to separate years from months/days.</p>
<p>Now, our dataset is cleaned up and ready to go.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="data-preparation.html#cb225-1" aria-hidden="true" tabindex="-1"></a>messy_df</span></code></pre></div>
<pre><code>##   last_name first_name gender       date income
## 1     Wayne       John   male 2018-11-15 150000
## 2     Trump    Melania female 2018-11-01 250000
## 3      Marx       Karl   male 2018-11-02  10000</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="data-preparation.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(messy_df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  5 variables:
##  $ last_name : chr  &quot;Wayne&quot; &quot;Trump&quot; &quot;Marx&quot;
##  $ first_name: chr  &quot;John&quot; &quot;Melania&quot; &quot;Karl&quot;
##  $ gender    : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 2
##  $ date      : Date, format: &quot;2018-11-15&quot; ...
##  $ income    : int  150000 250000 10000</code></pre>
</div>
</div>
<div id="reshaping-datasets" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Reshaping datasets</h2>
<p>Apart from cleaning and standardizing individual data columns, preparing a dataset for analysis often involves bringing the entire dataset in the right ‘shape.’ Typically, what we mean by this is that in a table-like (two-dimensional) format such as <code>data.frames</code> and <code>tibbles</code>, data with repeated observations for the same unit can be displayed/stored in either <em>long</em> or <em>wide</em> format. It is often seen as good practice to prepare data for analysis in <em>long</em> (‘tidy’) format. This way we ensure that we follow the (‘tidy’) paradigm of using the rows for individual observations and the columns to describe these observations.<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a> Tidying/reshaping a dataset in this way thus involves transforming columns into rows (i.e., <em>melting</em> the dataset). In the following, we first have a close look at what this means conceptually and then apply this technique in two examples.</p>
<div id="tidying-messy-datasets." class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Tidying messy datasets.</h3>
<p>Consider the following stylized example <span class="citation">(<a href="references.html#ref-wickham_2014" role="doc-biblioref">Wickham 2014</a>)</span>.</p>
<table>
<thead>
<tr class="header">
<th align="left">person</th>
<th align="right">treatmenta</th>
<th align="right">treatmentb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">John Smith</td>
<td align="right">NA</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Jane Doe</td>
<td align="right">16</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Mary Johnson</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The table shows observations of three individuals participating in an experiment. In this experiment, the subjects might have been exposed to treatment a and/or treatment b. Their reaction to either treatment is measured in numeric values (the results of the experiment). From looking at the raw data in its current shape, this is not really clear. While we see which numeric value corresponds to which person and treatment, it is not clear what this value is. One might, for example, wrongly assume that the numeric values refer to the treatment intensity of a and b. Such interpretation would be in line with the idea of columns containing variables and rows observations. But, considering what the numeric values actually stand for, we realize that the columns actually are not <em>names of variables</em> but <em>values</em> of a variable (the categorical variable <code>treatment</code>, with levels <code>a</code> and <code>b</code>).</p>
<p>Now consider the same data in ‘tidy’ format (variables in columns and observations in rows).</p>
<table>
<thead>
<tr class="header">
<th align="left">person</th>
<th align="left">treatment</th>
<th align="right">result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">John Smith</td>
<td align="left">a</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">John Smith</td>
<td align="left">b</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Jane Doe</td>
<td align="left">a</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">Jane Doe</td>
<td align="left">b</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Mary Johnson</td>
<td align="left">a</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Mary Johnson</td>
<td align="left">b</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>This <em>long</em>/<em>tidy</em> shape of the dataset has several advantages. First, it is now clear what the numeric values refer to. Second, in this format it is much easier to filter/select the observations.</p>
</div>
<div id="pivoting-from-wide-to-long-gathering" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Pivoting from ‘wide to long’ (“gathering”)</h3>
<p>In the <code>tidyverse</code> context, we call the transformation of columns to rows ‘pivoting from wide to long.’ That is we pivot columns into keys (or names) and values. A most typical situation where this has to be done in applied data analysis is when a dataset contains for the same subjects several observations over time. To illustrate how <em>pivoting from wide to long</em> works in practice, consider the following example dataset (extending on the example above).</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="data-preparation.html#cb229-1" aria-hidden="true" tabindex="-1"></a>wide_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">last_name =</span> <span class="fu">c</span>(<span class="st">&quot;Wayne&quot;</span>, <span class="st">&quot;Trump&quot;</span>, <span class="st">&quot;Marx&quot;</span>),</span>
<span id="cb229-2"><a href="data-preparation.html#cb229-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">first_name =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Melania&quot;</span>, <span class="st">&quot;Karl&quot;</span>),</span>
<span id="cb229-3"><a href="data-preparation.html#cb229-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>),</span>
<span id="cb229-4"><a href="data-preparation.html#cb229-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">income.2018 =</span> <span class="fu">c</span>(<span class="st">&quot;150000&quot;</span>, <span class="st">&quot;250000&quot;</span>, <span class="st">&quot;10000&quot;</span>),</span>
<span id="cb229-5"><a href="data-preparation.html#cb229-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">income.2017 =</span> <span class="fu">c</span>( <span class="st">&quot;140000&quot;</span>, <span class="st">&quot;230000&quot;</span>, <span class="st">&quot;15000&quot;</span>),</span>
<span id="cb229-6"><a href="data-preparation.html#cb229-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb229-7"><a href="data-preparation.html#cb229-7" aria-hidden="true" tabindex="-1"></a>wide_df</span></code></pre></div>
<pre><code>##   last_name first_name gender income.2018 income.2017
## 1     Wayne       John   male      150000      140000
## 2     Trump    Melania female      250000      230000
## 3      Marx       Karl   male       10000       15000</code></pre>
<p>The two last columns contain both information on the same variable (<code>income</code>), but for different years. We thus want to pivot these two columns in a new <code>year</code> and <code>income</code> column, ensuring that columns correspond to variables and rows correspond to observations. For this, we call the <code>pivot_longer()</code>-function as follows:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="data-preparation.html#cb231-1" aria-hidden="true" tabindex="-1"></a>long_df <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(wide_df, <span class="fu">c</span>(income<span class="fl">.2018</span>, income<span class="fl">.2017</span>), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;income&quot;</span>)</span>
<span id="cb231-2"><a href="data-preparation.html#cb231-2" aria-hidden="true" tabindex="-1"></a>long_df</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   last_name first_name gender year        income
##   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt; 
## 1 Wayne     John       male   income.2018 150000
## 2 Wayne     John       male   income.2017 140000
## 3 Trump     Melania    female income.2018 250000
## 4 Trump     Melania    female income.2017 230000
## 5 Marx      Karl       male   income.2018 10000 
## 6 Marx      Karl       male   income.2017 15000</code></pre>
<p>We can further clean the <code>year</code> column to only contain the respective numeric values.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="data-preparation.html#cb233-1" aria-hidden="true" tabindex="-1"></a>long_df<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(long_df<span class="sc">$</span>year, <span class="st">&quot;income.&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb233-2"><a href="data-preparation.html#cb233-2" aria-hidden="true" tabindex="-1"></a>long_df</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   last_name first_name gender year  income
##   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; 
## 1 Wayne     John       male   2018  150000
## 2 Wayne     John       male   2017  140000
## 3 Trump     Melania    female 2018  250000
## 4 Trump     Melania    female 2017  230000
## 5 Marx      Karl       male   2018  10000 
## 6 Marx      Karl       male   2017  15000</code></pre>
</div>
<div id="pivoting-from-long-to-wide-spreading" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Pivoting from ‘long to wide’ (“spreading”)</h3>
<p>As we want to adhere to the ‘tidy’ paradigm of keeping our data in long format, the transformation of ‘long to wide’ is less common. However, it might be necessary if the dataset at hand is particularly messy. The following example illustrates such a situation.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="data-preparation.html#cb235-1" aria-hidden="true" tabindex="-1"></a>weird_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">last_name =</span> <span class="fu">c</span>(<span class="st">&quot;Wayne&quot;</span>, <span class="st">&quot;Trump&quot;</span>, <span class="st">&quot;Marx&quot;</span>,</span>
<span id="cb235-2"><a href="data-preparation.html#cb235-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;Wayne&quot;</span>, <span class="st">&quot;Trump&quot;</span>, <span class="st">&quot;Marx&quot;</span>,</span>
<span id="cb235-3"><a href="data-preparation.html#cb235-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;Wayne&quot;</span>, <span class="st">&quot;Trump&quot;</span>, <span class="st">&quot;Marx&quot;</span>),</span>
<span id="cb235-4"><a href="data-preparation.html#cb235-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">first_name =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Melania&quot;</span>, <span class="st">&quot;Karl&quot;</span>,</span>
<span id="cb235-5"><a href="data-preparation.html#cb235-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;John&quot;</span>, <span class="st">&quot;Melania&quot;</span>, <span class="st">&quot;Karl&quot;</span>,</span>
<span id="cb235-6"><a href="data-preparation.html#cb235-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;John&quot;</span>, <span class="st">&quot;Melania&quot;</span>, <span class="st">&quot;Karl&quot;</span>),</span>
<span id="cb235-7"><a href="data-preparation.html#cb235-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>,</span>
<span id="cb235-8"><a href="data-preparation.html#cb235-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>,</span>
<span id="cb235-9"><a href="data-preparation.html#cb235-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>),</span>
<span id="cb235-10"><a href="data-preparation.html#cb235-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value =</span> <span class="fu">c</span>(<span class="st">&quot;150000&quot;</span>, <span class="st">&quot;250000&quot;</span>, <span class="st">&quot;10000&quot;</span>,</span>
<span id="cb235-11"><a href="data-preparation.html#cb235-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;2000000&quot;</span>, <span class="st">&quot;5000000&quot;</span>, <span class="st">&quot;NA&quot;</span>,</span>
<span id="cb235-12"><a href="data-preparation.html#cb235-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;50&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;NA&quot;</span>),</span>
<span id="cb235-13"><a href="data-preparation.html#cb235-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&quot;income&quot;</span>, <span class="st">&quot;income&quot;</span>, <span class="st">&quot;income&quot;</span>,</span>
<span id="cb235-14"><a href="data-preparation.html#cb235-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;assets&quot;</span>, <span class="st">&quot;assets&quot;</span>, <span class="st">&quot;assets&quot;</span>,</span>
<span id="cb235-15"><a href="data-preparation.html#cb235-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;age&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;age&quot;</span>),</span>
<span id="cb235-16"><a href="data-preparation.html#cb235-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb235-17"><a href="data-preparation.html#cb235-17" aria-hidden="true" tabindex="-1"></a>weird_df</span></code></pre></div>
<pre><code>##   last_name first_name gender   value variable
## 1     Wayne       John   male  150000   income
## 2     Trump    Melania female  250000   income
## 3      Marx       Karl   male   10000   income
## 4     Wayne       John   male 2000000   assets
## 5     Trump    Melania female 5000000   assets
## 6      Marx       Karl   male      NA   assets
## 7     Wayne       John   male      50      age
## 8     Trump    Melania female      25      age
## 9      Marx       Karl   male      NA      age</code></pre>
<p>While the data is somehow in long format, the rule that each column should correspond to a variable (and vice versa) is ignored. Data on income, assets, as well as the age of the individuals in the dataset are all put in the same column. We can call the function <code>pivot_wider()</code> with the two parameters <code>names</code> and <code>value</code> to correct this.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="data-preparation.html#cb237-1" aria-hidden="true" tabindex="-1"></a>tidy_df <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(weird_df, <span class="at">names_from =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb237-2"><a href="data-preparation.html#cb237-2" aria-hidden="true" tabindex="-1"></a>tidy_df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   last_name first_name gender income assets  age  
##   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;
## 1 Wayne     John       male   150000 2000000 50   
## 2 Trump     Melania    female 250000 5000000 25   
## 3 Marx      Karl       male   10000  NA      NA</code></pre>
</div>
</div>
<div id="tutorial-hotel-bookings-time-series" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Tutorial: Hotel Bookings Time Series</h2>
<p>This tutorial guides you step-by-step through the cleaning script (with a few adaptions) of <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-02-11">tidytuesday’s Hotel Bookings repo</a>, dealing with the preparation and analysis of two datasets with <em>hotel demand data</em>. Along the way, you also get in touch with the <a href="https://github.com/sfirke/janitor">janitor package</a>. For details about the two datasets see the <a href="https://www.sciencedirect.com/science/article/pii/S2352340918315191#f0010">paper</a> by <span class="citation"><a href="references.html#ref-nuno_etal2019" role="doc-biblioref">Nuno Antonio, de Almeida, and Nunes</a> (<a href="references.html#ref-nuno_etal2019" role="doc-biblioref">2019</a>)</span> and for the original research contribution related to these datasets see the <a href="https://ieeexplore.ieee.org/document/8260781">paper</a> by <span class="citation"><a href="references.html#ref-nunes_etal2017" role="doc-biblioref">N. Antonio, de Almeida, and Nunes</a> (<a href="references.html#ref-nunes_etal2017" role="doc-biblioref">2017</a>)</span>.</p>
<p><span class="citation"><a href="references.html#ref-nuno_etal2019" role="doc-biblioref">Nuno Antonio, de Almeida, and Nunes</a> (<a href="references.html#ref-nuno_etal2019" role="doc-biblioref">2019</a>)</span> summarize the content of the datasets as follows: “One of the hotels (H1) is a resort hotel and the other is a city hotel (H2). Both datasets share the same structure, with 31 variables describing the 40,060 observations of H1 and 79,330 observations of H2. Each observation represents a hotel booking. Both datasets comprehend bookings due to arrive between the 1st of July of 2015 and the 31st of August 2017, including bookings that effectively arrived and bookings that were canceled. Since this is real data, all data elements pertaining hotel or costumer identification were deleted. Due to the scarcity of real business data for scientific and educational purposes, these datasets can have an important role for research and education in revenue management, machine learning, or data mining, as well as in other fields.”</p>
<p>The aim of the tutorial is to get the data in the form needed for the following plot.</p>
<p><img src="datahandling_files/figure-html/unnamed-chunk-121-1.svg" width="672" /></p>
<p>The first few rows and columns of the final dataset should combine the two source datasets and look as follows:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="data-preparation.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hotel_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 32
##   hotel        is_canceled lead_time arrival_date_year
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
## 1 Resort Hotel           0       342              2015
## 2 Resort Hotel           0       737              2015
## 3 Resort Hotel           0         7              2015
## 4 Resort Hotel           0        13              2015
## 5 Resort Hotel           0        14              2015
## 6 Resort Hotel           0        14              2015
## # … with 28 more variables: arrival_date_month &lt;chr&gt;,
## #   arrival_date_week_number &lt;dbl&gt;,
## #   arrival_date_day_of_month &lt;dbl&gt;,
## #   stays_in_weekend_nights &lt;dbl&gt;,
## #   stays_in_week_nights &lt;dbl&gt;, adults &lt;dbl&gt;,
## #   children &lt;dbl&gt;, babies &lt;dbl&gt;, meal &lt;chr&gt;,
## #   country &lt;chr&gt;, market_segment &lt;chr&gt;,
## #   distribution_channel &lt;chr&gt;,
## #   is_repeated_guest &lt;dbl&gt;,
## #   previous_cancellations &lt;dbl&gt;,
## #   previous_bookings_not_canceled &lt;dbl&gt;,
## #   reserved_room_type &lt;chr&gt;,
## #   assigned_room_type &lt;chr&gt;, booking_changes &lt;dbl&gt;,
## #   deposit_type &lt;chr&gt;, agent &lt;chr&gt;, company &lt;chr&gt;,
## #   days_in_waiting_list &lt;dbl&gt;, customer_type &lt;chr&gt;,
## #   adr &lt;dbl&gt;, required_car_parking_spaces &lt;dbl&gt;,
## #   total_of_special_requests &lt;dbl&gt;,
## #   reservation_status &lt;chr&gt;,
## #   reservation_status_date &lt;date&gt;</code></pre>
</div>
<div id="set-up-and-import" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Set up and import</h2>
<p>All the tools we need for this tutorial are provided in <code>tidyverse</code> and <code>janitor</code>, and the data is directly available from the <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-02-11">tidytuesday GitHub repository</a>. The original data is provided in csv format.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="data-preparation.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SET UP --------------</span></span>
<span id="cb241-2"><a href="data-preparation.html#cb241-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-3"><a href="data-preparation.html#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb241-4"><a href="data-preparation.html#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb241-5"><a href="data-preparation.html#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor) <span class="co"># install.packages(&quot;janitor&quot;) (if not yet installed)</span></span>
<span id="cb241-6"><a href="data-preparation.html#cb241-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-7"><a href="data-preparation.html#cb241-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fix variables</span></span>
<span id="cb241-8"><a href="data-preparation.html#cb241-8" aria-hidden="true" tabindex="-1"></a>url_h1 <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-11/H1.csv&quot;</span></span>
<span id="cb241-9"><a href="data-preparation.html#cb241-9" aria-hidden="true" tabindex="-1"></a>url_h2 <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-11/H2.csv&quot;</span></span>
<span id="cb241-10"><a href="data-preparation.html#cb241-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-11"><a href="data-preparation.html#cb241-11" aria-hidden="true" tabindex="-1"></a><span class="do">## DATA IMPORT -----------------</span></span>
<span id="cb241-12"><a href="data-preparation.html#cb241-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-13"><a href="data-preparation.html#cb241-13" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url_h1)</span>
<span id="cb241-14"><a href="data-preparation.html#cb241-14" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url_h2)</span></code></pre></div>
<p>In a next step we clean the column names and add an additional column in order to clarify to which of the two hotels the corresponding observations belong (see dataset description above). Finally, we stack the observations (rows) together in one tibble/data.frame.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="data-preparation.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="do">## CLEAN DATA -------------------------</span></span>
<span id="cb242-2"><a href="data-preparation.html#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="data-preparation.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use the janitor-package clean_names function. see ?clean_names for details</span></span>
<span id="cb242-4"><a href="data-preparation.html#cb242-4" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(h1)</span>
<span id="cb242-5"><a href="data-preparation.html#cb242-5" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(h2)</span>
<span id="cb242-6"><a href="data-preparation.html#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="data-preparation.html#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add column to clarify origin of observation</span></span>
<span id="cb242-8"><a href="data-preparation.html#cb242-8" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(h1, <span class="at">hotel=</span><span class="st">&quot;Resort Hotel&quot;</span>)</span>
<span id="cb242-9"><a href="data-preparation.html#cb242-9" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(h2, <span class="at">hotel=</span><span class="st">&quot;City Hotel&quot;</span>)</span>
<span id="cb242-10"><a href="data-preparation.html#cb242-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-11"><a href="data-preparation.html#cb242-11" aria-hidden="true" tabindex="-1"></a><span class="co"># stack observations</span></span>
<span id="cb242-12"><a href="data-preparation.html#cb242-12" aria-hidden="true" tabindex="-1"></a>hotel_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(h1,h2)</span>
<span id="cb242-13"><a href="data-preparation.html#cb242-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-14"><a href="data-preparation.html#cb242-14" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the first observations</span></span>
<span id="cb242-15"><a href="data-preparation.html#cb242-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hotel_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 32
##   is_canceled lead_time arrival_date_year
##         &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
## 1           0       342              2015
## 2           0       737              2015
## 3           0         7              2015
## 4           0        13              2015
## 5           0        14              2015
## 6           0        14              2015
## # … with 29 more variables: arrival_date_month &lt;chr&gt;,
## #   arrival_date_week_number &lt;dbl&gt;,
## #   arrival_date_day_of_month &lt;dbl&gt;,
## #   stays_in_weekend_nights &lt;dbl&gt;,
## #   stays_in_week_nights &lt;dbl&gt;, adults &lt;dbl&gt;,
## #   children &lt;dbl&gt;, babies &lt;dbl&gt;, meal &lt;chr&gt;,
## #   country &lt;chr&gt;, market_segment &lt;chr&gt;,
## #   distribution_channel &lt;chr&gt;,
## #   is_repeated_guest &lt;dbl&gt;,
## #   previous_cancellations &lt;dbl&gt;,
## #   previous_bookings_not_canceled &lt;dbl&gt;,
## #   reserved_room_type &lt;chr&gt;,
## #   assigned_room_type &lt;chr&gt;, booking_changes &lt;dbl&gt;,
## #   deposit_type &lt;chr&gt;, agent &lt;chr&gt;, company &lt;chr&gt;,
## #   days_in_waiting_list &lt;dbl&gt;, customer_type &lt;chr&gt;,
## #   adr &lt;dbl&gt;, required_car_parking_spaces &lt;dbl&gt;,
## #   total_of_special_requests &lt;dbl&gt;,
## #   reservation_status &lt;chr&gt;,
## #   reservation_status_date &lt;date&gt;, hotel &lt;chr&gt;</code></pre>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="20">
<li id="fn20"><p>The option <code>stringsAsFactors = FALSE</code> ensures that all of the columns in this data frame are of type <code>character</code>.<a href="data-preparation.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>If we perform the same operation on this variable <em>before</em> coercing it to a <code>factor</code>, this problem does not occur.<a href="data-preparation.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>Depending on the dataset, however, an argument can be made that storing the data in wide format might be more efficient (using up less memory) than long format.<a href="data-preparation.html#fnref22" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources-data-gathering-data-import.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-analysis-first-steps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["datahandling.pdf", "datahandling.html", "datahandling.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
